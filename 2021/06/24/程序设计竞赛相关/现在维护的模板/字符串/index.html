<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"manual"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这里记录了字符串方面平时个人常用的代码模板。">
<meta property="og:type" content="article">
<meta property="og:title" content="字符串代码模板">
<meta property="og:url" content="http://example.com/2021/06/24/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AB%9E%E8%B5%9B%E7%9B%B8%E5%85%B3/%E7%8E%B0%E5%9C%A8%E7%BB%B4%E6%8A%A4%E7%9A%84%E6%A8%A1%E6%9D%BF/%E5%AD%97%E7%AC%A6%E4%B8%B2/index.html">
<meta property="og:site_name" content="零岛">
<meta property="og:description" content="这里记录了字符串方面平时个人常用的代码模板。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-06-24T07:42:54.000Z">
<meta property="article:modified_time" content="2023-01-27T13:21:17.125Z">
<meta property="article:author" content="Overstars">
<meta property="article:tag" content="算法模板">
<meta property="article:tag" content="字符串">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2021/06/24/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AB%9E%E8%B5%9B%E7%9B%B8%E5%85%B3/%E7%8E%B0%E5%9C%A8%E7%BB%B4%E6%8A%A4%E7%9A%84%E6%A8%A1%E6%9D%BF/%E5%AD%97%E7%AC%A6%E4%B8%B2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2021/06/24/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AB%9E%E8%B5%9B%E7%9B%B8%E5%85%B3/%E7%8E%B0%E5%9C%A8%E7%BB%B4%E6%8A%A4%E7%9A%84%E6%A8%A1%E6%9D%BF/%E5%AD%97%E7%AC%A6%E4%B8%B2/","path":"2021/06/24/程序设计竞赛相关/现在维护的模板/字符串/","title":"字符串代码模板"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>字符串代码模板 | 零岛</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">零岛</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">回朕车以复路兮，及行迷之未远</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.</span> <span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#KMP"><span class="nav-number">1.1.</span> <span class="nav-text">KMP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EXKMP"><span class="nav-number">1.2.</span> <span class="nav-text">EXKMP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Manacher"><span class="nav-number">1.3.</span> <span class="nav-text">Manacher</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AC%E8%87%AA%E5%8A%A8%E6%9C%BA"><span class="nav-number">1.4.</span> <span class="nav-text">AC自动机</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#fail%E6%A0%91%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="nav-number">1.4.1.</span> <span class="nav-text">fail树应用举例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%BB%91%E9%BE%99%E6%B1%9F%E7%9C%81%E8%B5%9B-E-Elastic-Search"><span class="nav-number">1.4.2.</span> <span class="nav-text">黑龙江省赛 E.Elastic Search</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84"><span class="nav-number">1.5.</span> <span class="nav-text">后缀数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%B8%8D%E6%98%AF%E5%BE%88%E5%A5%BD%E7%9A%84%E5%A4%A7%E6%95%B0%E8%AE%A1%E7%AE%97%E6%A8%A1%E6%9D%BF"><span class="nav-number">1.6.</span> <span class="nav-text">性能不是很好的大数计算模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%A7%E6%95%B0%E6%A8%A1%E6%9D%BF"><span class="nav-number">1.7.</span> <span class="nav-text">大数模板</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Overstars"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">Overstars</p>
  <div class="site-description" itemprop="description">这个人非常的菜</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">53</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Oversatrs" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Oversatrs" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:Overstars@foxmail.com" title="E-Mail → mailto:Overstars@foxmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/Oversatrs" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;Oversatrs" rel="noopener me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/Miaplacidus" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;Miaplacidus" rel="noopener me" target="_blank"><i class="fab fa-solid fa-c fa-fw"></i>CSDN</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/24/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AB%9E%E8%B5%9B%E7%9B%B8%E5%85%B3/%E7%8E%B0%E5%9C%A8%E7%BB%B4%E6%8A%A4%E7%9A%84%E6%A8%A1%E6%9D%BF/%E5%AD%97%E7%AC%A6%E4%B8%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Overstars">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="零岛">
      <meta itemprop="description" content="这个人非常的菜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="字符串代码模板 | 零岛">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          字符串代码模板
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
  
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-06-24 15:42:54" itemprop="dateCreated datePublished" datetime="2021-06-24T15:42:54+08:00">2021-06-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-27 21:21:17" itemprop="dateModified" datetime="2023-01-27T21:21:17+08:00">2023-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF/" itemprop="url" rel="index"><span itemprop="name">算法模板</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>这里记录了字符串方面平时个人常用的代码模板。</p>
<span id="more"></span>

<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><h3 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h3><ul>
<li>可能存在的最小循环串始终为len-nex[len-1],len为字符串长度</li>
<li>重复串长度&#x3D;母串长-next[i]</li>
<li>求A串前缀和B串后缀的最大公共匹配串,可以拼接后求KMP</li>
<li>将原串反转后拼接求next，可以得到</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> w[<span class="number">10005</span>],t[<span class="number">1000005</span>];</span><br><span class="line"><span class="type">int</span> nex[<span class="number">10005</span>];<span class="comment">//nex[i]记录w[0:i]串的最大公共串长度</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getnext</span><span class="params">(<span class="type">char</span> *B,<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    nex[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,j=<span class="number">0</span>;i&lt;n;i++)<span class="comment">/* n为B串长度 */</span></span><br><span class="line">    &#123;</span><br><span class="line"><span class="comment">//        j=nex[i-1];j为待计算位前一位对应的最大公共串的下一位(或前一位对应的最大公共串长度)</span></span><br><span class="line">        <span class="keyword">while</span>(B[j]!=B[i]&amp;&amp;j&gt;<span class="number">0</span>)<span class="comment">//若匹配不上,尝试缩小公共子串,因为B串i之前的j个字符(B[i-j]~B[i-1])与开头的j个(B[0]~B[j-1])相同,直接在前面j个字符里找</span></span><br><span class="line">            j=nex[j<span class="number">-1</span>];<span class="comment">//找最大公共子串的下一位与B[i]相同的最大公共子串,不能用j--,保证B[0]到B[i-1]这段目前匹配前缀后缀始终相同</span></span><br><span class="line">        <span class="keyword">if</span>(B[j]==B[i])<span class="comment">//公共串下一位字符相同，公共最大长+1</span></span><br><span class="line">            j++;</span><br><span class="line">        nex[i]=j;<span class="comment">//j为0~i最大公共串长度,若最终B[j]!=B[i],j=0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">//https://www.cnblogs.com/c-cloud/p/3224788.html</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">kmp</span><span class="params">(<span class="type">int</span> m,<span class="type">int</span> n)</span><span class="comment">//m为A串长度,n为B串长度</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>,cmp=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(cmp&gt;<span class="number">0</span>&amp;&amp;t[i]!=w[cmp])<span class="comment">//第cmp个位置匹配失败</span></span><br><span class="line">            cmp=nex[cmp<span class="number">-1</span>];<span class="comment">//下一轮从匹配成功串的最大公共串的下一位开始匹配</span></span><br><span class="line">        <span class="keyword">if</span>(t[i]==w[cmp])<span class="comment">//当前字符匹配成功,继续下一位</span></span><br><span class="line">            cmp++;</span><br><span class="line">        <span class="keyword">if</span>(cmp==n)&#123;<span class="comment">//子串匹配成功</span></span><br><span class="line">            ans++;</span><br><span class="line">            cmp=nex[cmp<span class="number">-1</span>];<span class="comment">//本题母串分割各部分间可以有公共部分</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="EXKMP"><a href="#EXKMP" class="headerlink" title="EXKMP"></a>EXKMP</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> s[<span class="number">1000005</span>];</span><br><span class="line"><span class="type">int</span> nex[<span class="number">1000005</span>],extend[<span class="number">1000005</span>];<span class="comment">//ex[i]存储母串的子串S[i:n-1]与T的公共前缀长度</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GetNext</span><span class="params">(<span class="type">char</span> T[],<span class="type">int</span> m,<span class="type">int</span> nex[])</span><span class="comment">//先计算模式串的next数组</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//之前匹配过程中所达到的最远位置为p(匹配串最后一个字符为T[p-1]),并且以T[a]为起始</span></span><br><span class="line">    <span class="type">int</span> a=<span class="number">0</span>,p=<span class="number">0</span>;<span class="comment">//边界情况,此时不能令p=m,避免T[0]与T[0]对齐</span></span><br><span class="line">    nex[<span class="number">0</span>]=m;<span class="comment">//与自身完全匹配</span></span><br><span class="line">    <span class="comment">//T[i]串和T[i-a]串对齐,来求nex[i]</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;m;i++)<span class="comment">//计算子串T[i]...T[m-1]的匹配长</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;=p||i+nex[i-a]&gt;=p)<span class="comment">//最右匹配串需要更新</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=p)</span><br><span class="line">                p=i;<span class="comment">//i&lt;p时T[i]~T[p-1]与T[0]~T[p-i-1]相同</span></span><br><span class="line">            <span class="keyword">while</span>(p&lt;m&amp;&amp;T[p]==T[p-i])</span><br><span class="line">                p++;<span class="comment">//更新最右值,T[p]与T[p-i]匹配失败则跳出</span></span><br><span class="line">            nex[i]=p-i;<span class="comment">//最大匹配长T[0]~T[p-i-1]</span></span><br><span class="line">            a=i;<span class="comment">//更新最右匹配串起始位置</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span><span class="comment">//在之前的最长匹配串中,所以T[i]==T[i-a],T[i+nex[i-a]]==T[i-a+nex[i-a]],且T[i-a]串在T[nex[i-a]]处截断(相当于T[0+nex[i-a]]!=T[i-a+nex[i-a]])</span></span><br><span class="line">            nex[i]=nex[i-a];<span class="comment">//所以T[i]也在T[nex[i-a]]处截断(T[i+nex[i-a]]!=T[0+nex[i-a]]),即为匹配串长度</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GetExtend</span><span class="params">(<span class="type">char</span> S[],<span class="type">int</span> n,<span class="type">char</span> T[],<span class="type">int</span> m,<span class="type">int</span> extend[],<span class="type">int</span> next[])</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//注意:比较过程中T[0]始终与S[a]对齐</span></span><br><span class="line">    <span class="type">int</span> a=<span class="number">0</span>,p=<span class="number">0</span>;<span class="comment">//a,p为母串S上的标记,p为之前匹配过程中所达到的最远位置</span></span><br><span class="line">    <span class="built_in">GetNext</span>(T,m,next);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)<span class="comment">//计算子串S[i]...S[n-1]与T的匹配长</span></span><br><span class="line">    &#123;<span class="comment">//i一定≥a,所以要求p尽量在最右,而不必特别关注a</span></span><br><span class="line">        <span class="keyword">if</span>(i&gt;=p||i+next[i-a]&gt;=p)<span class="comment">//a和p都要更新</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=p)<span class="comment">//i&gt;=p的作用:举个典型例子,S和T无一字符相同</span></span><br><span class="line">                p=i;<span class="comment">//i&gt;=p时更新最右值p,i&lt;p时S[i]~S[p-1]与T[0]~T[p-i-1]匹配</span></span><br><span class="line">            <span class="keyword">while</span>(p&lt;n&amp;&amp;p-i&lt;m&amp;&amp;S[p]==T[p-i])<span class="comment">//</span></span><br><span class="line">                p++;</span><br><span class="line">            extend[i]=p-i;<span class="comment">//S[i]~S[p-1],共p-i个字符匹配</span></span><br><span class="line">            a=i;<span class="comment">//更新最右匹配串起始位置,当i超出了p时,以i开头重新计算p</span></span><br><span class="line">        &#125;<span class="comment">//但当p&lt;i&amp;&amp;i+next[i-a]&gt;=p时,a更不更新不影响</span></span><br><span class="line">        <span class="keyword">else</span><span class="comment">//未超出最右匹配串,即S[i]~S[i+nex[i-a]]==T[i-a]~T[i-a+nex[i-a]],T[0+nex[i-a]]!=T[i-a+nex[i-a]]</span></span><br><span class="line">            extend[i]=next[i-a];<span class="comment">//所以S[i+nex[i-a]]!=T[0+nex[i-a]],nex[i-a]即为匹配串长度</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Manacher"><a href="#Manacher" class="headerlink" title="Manacher"></a>Manacher</h3><ul>
<li>String:加’#’处理后的回文串</li>
<li>MaxR:最长回文半径对应的右端字符MaxRight</li>
<li>flag:最长回文半径对应的中心点下标</li>
<li>cnt[i]:以i为中心对应的回文半径</li>
<li>l:String长度</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> maxlen=<span class="number">110005</span>;</span><br><span class="line"><span class="type">char</span> str[maxlen],String[maxlen&lt;&lt;<span class="number">1</span>];<span class="comment">//存储处理前后字符串</span></span><br><span class="line"><span class="type">int</span> cnt[maxlen&lt;&lt;<span class="number">1</span>];<span class="comment">//记录处理后字符串i点最大回文半径</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Manacher</span><span class="params">(<span class="type">char</span> s[],<span class="type">int</span> len)</span><span class="comment">//原字符串和串长</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>;</span><br><span class="line">    String[l++] = <span class="string">&#x27;$&#x27;</span>; <span class="comment">// 0下标存储为其他字符,防止越界</span></span><br><span class="line">    String[l++] = <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        String[l++]=s[i];</span><br><span class="line">        String[l++]=<span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    String[l]=<span class="string">&#x27;\0&#x27;</span>; <span class="comment">// 空字符</span></span><br><span class="line">    <span class="type">int</span> MaxR=<span class="number">0</span>;<span class="comment">//之前的回文半径中伸展到的最右端字符MaxRight</span></span><br><span class="line">    <span class="type">int</span> flag=<span class="number">0</span>;<span class="comment">//最右回文半径对应的中心点下标</span></span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;l;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;MaxR)<span class="comment">//i一定大于flag(在一开始及i赋值给flag时i==flag)</span></span><br><span class="line">            cnt[i]=<span class="built_in">min</span>(cnt[(flag&lt;&lt;<span class="number">1</span>)-i],MaxR-i);<span class="comment">//2*flag-i是i点关于flag的对称点,记为i&#x27;</span></span><br><span class="line">        <span class="keyword">else</span><span class="comment">//因为关于flag对称,当i+cnt[i&#x27;]&lt;=MaxR时,i两边cnt[i&#x27;]个字符关于i对称,可以避免重复匹配。取min是因为i+cnt[i&#x27;]有可能超出MaxR</span></span><br><span class="line">            cnt[i]=<span class="number">1</span>;<span class="comment">//从头开始匹配</span></span><br><span class="line">        <span class="keyword">while</span>(String[i+cnt[i]]==String[i-cnt[i]])</span><br><span class="line">            cnt[i]++;</span><br><span class="line">        <span class="keyword">if</span>(i+cnt[i]&gt;MaxR)<span class="comment">//新计算的回文串右端点位置大于MaxR</span></span><br><span class="line">        &#123;</span><br><span class="line">            MaxR=i+cnt[i];<span class="comment">//更新到达最右端点</span></span><br><span class="line">            flag=i;</span><br><span class="line">        &#125;</span><br><span class="line">        ans=<span class="built_in">max</span>(ans,cnt[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AC自动机"><a href="#AC自动机" class="headerlink" title="AC自动机"></a>AC自动机</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">1000005</span>, M = <span class="number">26</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AhoCorasickAutomaton</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> trie[maxn][M],isw[maxn],fail[maxn],siz;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span><span class="comment">//fail指向当前状态的最长后缀状态</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        siz=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(trie[<span class="number">0</span>],<span class="number">0</span>,<span class="built_in">sizeof</span>(trie[<span class="number">0</span>]));</span><br><span class="line">        <span class="built_in">memset</span>(isw,<span class="number">0</span>,<span class="built_in">sizeof</span>(isw));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">mp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;ch)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)(ch-<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Insert</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str)</span><span class="comment">//rt传入0</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//trie插入模式串</span></span><br><span class="line">        <span class="type">int</span> len=<span class="built_in">strlen</span>(str),rt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> id = <span class="built_in">mp</span>(str[i]);</span><br><span class="line">            <span class="keyword">if</span>(!trie[rt][id])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">memset</span>(trie[siz],<span class="number">0</span>,<span class="built_in">sizeof</span>(trie[siz]));</span><br><span class="line">                trie[rt][id]=siz++;</span><br><span class="line">            &#125;</span><br><span class="line">            rt = trie[rt][id];</span><br><span class="line">        &#125;</span><br><span class="line">        isw[rt]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span><span class="comment">//构造fail指针</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; Q;</span><br><span class="line">        fail[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> id=<span class="number">0</span>,rt;id&lt;M;id++)</span><br><span class="line">        &#123;</span><br><span class="line">            rt=trie[<span class="number">0</span>][id];</span><br><span class="line">            <span class="keyword">if</span>(rt)<span class="comment">//将根节点子节点入队</span></span><br><span class="line">            &#123;</span><br><span class="line">                Q.<span class="built_in">push</span>(rt);</span><br><span class="line">                fail[rt]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> rt=Q.<span class="built_in">front</span>();<span class="comment">//fail[rt]在之前已构建完毕</span></span><br><span class="line">            Q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> id=<span class="number">0</span>;id&lt;M;id++)<span class="comment">//枚举所有子节点</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> v=trie[rt][id];</span><br><span class="line">                <span class="keyword">if</span>(v)<span class="comment">//该号子节点存在</span></span><br><span class="line">                &#123;</span><br><span class="line">                    fail[v]=trie[fail[rt]][id];</span><br><span class="line">                    Q.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span><span class="comment">//将不存在的字典树的状态链接到了失配指针的对应状态</span></span><br><span class="line">                    trie[rt][id]=trie[fail[rt]][id];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//返回文本串中有多少模式串(一个模式串只记录一次答案)</span></span><br><span class="line">        <span class="type">int</span> ret=<span class="number">0</span>,rt=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> len=<span class="built_in">strlen</span>(str);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            rt=trie[rt][<span class="built_in">mp</span>(str[i])];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> tmp=rt;tmp&amp;&amp;~isw[tmp];tmp=fail[tmp])</span><br><span class="line">                ret+=isw[tmp],isw[tmp]=<span class="number">-1</span>;<span class="comment">//用fail找出所有匹配模式串</span></span><br><span class="line">        &#125;<span class="comment">//匹配成功的不会再匹配</span></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ac;</span><br></pre></td></tr></table></figure>

<h4 id="fail树应用举例"><a href="#fail树应用举例" class="headerlink" title="fail树应用举例"></a>fail树应用举例</h4><p>给你一个文本串 $S$ 和 $n$ 个模式串 $T_{1..n}$，请你分别求出每个模式串 $T_i$ 在 $S$ 中出现的次数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">BinaryIndexedsTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    ll c[maxn],sum[maxn];<span class="comment">//c维护差分数组,sum维护i*c[i]的前缀和</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x &amp; (-x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> n)</span><span class="comment">//a是原数组,n是元素个数</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n=n;</span><br><span class="line">        <span class="built_in">memset</span>(c,<span class="number">0</span>,<span class="built_in">sizeof</span>(c));</span><br><span class="line">        <span class="built_in">memset</span>(sum,<span class="number">0</span>,<span class="built_in">sizeof</span>(sum));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">            <span class="built_in">add</span>(i,a[i]-a[i<span class="number">-1</span>]);<span class="comment">//构建差分c数组</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> k,ll val)</span><span class="comment">//修改:a[k]加上val,直接在c数组上操作</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//请使用区间更新</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=k;i&lt;=n;i+=<span class="built_in">lowbit</span>(i))<span class="comment">//从叶子一直更新到父节点</span></span><br><span class="line">            c[i]+=val,sum[i]+=val*(k<span class="number">-1</span>);<span class="comment">//每个节点都加上val</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">radd</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,ll val)</span><span class="comment">//区间更新</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">add</span>(l,val);<span class="comment">//把l之后所有的点都更新一遍</span></span><br><span class="line">        <span class="built_in">add</span>(r+<span class="number">1</span>,-val);<span class="comment">//因为r之后的点是不用更新的,但是多更新了,所以要每个点都-val；</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">query</span><span class="params">(<span class="type">int</span> k)</span><span class="comment">//查询:c[i]前缀和的前缀和,即a[i]的前缀和</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//节点i的长度为lowbit(i)</span></span><br><span class="line">        ll ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=k;i;i-=<span class="built_in">lowbit</span>(i))</span><br><span class="line">            ret+=k*c[i]-sum[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; bit;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span>  M = <span class="number">26</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AhoCorasickAutomaton</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> trie[maxn][M],isw[maxn],fail[maxn],siz;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span><span class="comment">//fail指向当前状态的最长后缀状态</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        siz=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(trie[<span class="number">0</span>],<span class="number">0</span>,<span class="built_in">sizeof</span>(trie[<span class="number">0</span>]));</span><br><span class="line">        <span class="built_in">memset</span>(isw,<span class="number">0</span>,<span class="built_in">sizeof</span>(isw));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">mp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;ch)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)(ch-<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">Insert</span><span class="params">(string &amp;str)</span><span class="comment">//rt传入0</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//trie插入模式串</span></span><br><span class="line">        <span class="type">int</span> rt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;str.<span class="built_in">length</span>();i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> id = <span class="built_in">mp</span>(str[i]);</span><br><span class="line">            <span class="keyword">if</span>(!trie[rt][id])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">memset</span>(trie[siz],<span class="number">0</span>,<span class="built_in">sizeof</span>(trie[siz]));</span><br><span class="line">                trie[rt][id]=siz++;</span><br><span class="line">            &#125;</span><br><span class="line">            rt = trie[rt][id];</span><br><span class="line">        &#125;</span><br><span class="line">        isw[rt]++;<span class="comment">//标记这个点为结尾</span></span><br><span class="line">        <span class="keyword">return</span> rt;<span class="comment">//返回str对应的编号</span></span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;G[maxn];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span><span class="comment">//构造fail指针</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; Q;</span><br><span class="line">        fail[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> id=<span class="number">0</span>,rt;id&lt;M;id++)</span><br><span class="line">        &#123;</span><br><span class="line">            rt=trie[<span class="number">0</span>][id];</span><br><span class="line">            <span class="keyword">if</span>(rt)<span class="comment">//将根节点子节点入队</span></span><br><span class="line">            &#123;</span><br><span class="line">                Q.<span class="built_in">push</span>(rt);</span><br><span class="line">                fail[rt]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> rt=Q.<span class="built_in">front</span>();<span class="comment">//fail[rt]在之前已构建完毕</span></span><br><span class="line">            Q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> id=<span class="number">0</span>;id&lt;M;id++)<span class="comment">//枚举所有子节点</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> v=trie[rt][id];</span><br><span class="line">                <span class="keyword">if</span>(v)<span class="comment">//该号子节点存在</span></span><br><span class="line">                &#123;</span><br><span class="line">                    fail[v]=trie[fail[rt]][id];</span><br><span class="line">                    Q.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span><span class="comment">//将不存在的字典树的状态链接到了失配指针的对应状态</span></span><br><span class="line">                    trie[rt][id]=trie[fail[rt]][id];<span class="comment">//文本串可能访问未知节点</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;siz;i++)<span class="comment">//构建fail树,根为0</span></span><br><span class="line">        &#123;</span><br><span class="line">            G[fail[i]].<span class="built_in">push_back</span>(i);</span><br><span class="line"><span class="comment">//            fprintf(stderr,&quot;%d -&gt; %d\n&quot;,fail[i],i);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(string &amp;str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//返回文本串中有多少模式串(一个模式串只记录一次答案)</span></span><br><span class="line">        <span class="type">int</span> ret=<span class="number">0</span>,rt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> &amp;i:str)</span><br><span class="line">        &#123;</span><br><span class="line">            rt=trie[rt][<span class="built_in">mp</span>(i)];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> tmp=rt;tmp&amp;&amp;~isw[tmp];tmp=fail[tmp])</span><br><span class="line">                ret+=isw[tmp],isw[tmp]=<span class="number">-1</span>;<span class="comment">//用fail找出所有匹配模式串</span></span><br><span class="line">        &#125;<span class="comment">//匹配成功的不会再匹配</span></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> dfn[maxn],node[maxn],dfc=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dfn[x]=++dfc;</span><br><span class="line"><span class="comment">//        fprintf(stderr,&quot;dfn[%d] = %d\n&quot;,x,dfn[x]);</span></span><br><span class="line">        node[x]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;v:G[x])</span><br><span class="line">            node[x]+=<span class="built_in">dfs</span>(v,x);</span><br><span class="line">        <span class="keyword">return</span> node[x];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ac;</span><br><span class="line"><span class="type">int</span> tr[maxn][M];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//dfs序树上子树权值和</span></span><br><span class="line">    <span class="keyword">return</span> bit.<span class="built_in">query</span>(ac.dfn[x]+ac.node[x]<span class="number">-1</span>)-bit.<span class="built_in">query</span>(ac.dfn[x]<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">(<span class="type">signed</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>),cin.<span class="built_in">tie</span>(<span class="number">0</span>),cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;input.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    <span class="comment">//	freopen(&quot;output.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    ac.<span class="built_in">init</span>();</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line"><span class="comment">//    vector&lt;string&gt; rec(n);</span></span><br><span class="line">    string s;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;rec2;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cin&gt;&gt;s;</span><br><span class="line">        rec2.<span class="built_in">push_back</span>(ac.<span class="built_in">Insert</span>(s));</span><br><span class="line">    &#125;</span><br><span class="line">    bit.n=ac.siz+<span class="number">10</span>;</span><br><span class="line">    <span class="built_in">memcpy</span>(tr[<span class="number">0</span>],ac.trie[<span class="number">0</span>],<span class="built_in">sizeof</span>(<span class="type">int</span>)*maxn*M);<span class="comment">//之前建fail树会损坏trie</span></span><br><span class="line">    ac.<span class="built_in">build</span>();</span><br><span class="line">    ac.<span class="built_in">dfs</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;s;</span><br><span class="line">    <span class="type">int</span> rt=<span class="number">0</span>;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> mp(ch) (int)(ch-<span class="string">&#x27;a&#x27;</span>)</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;i:s)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(!tr[rt][<span class="built_in">mp</span>(i)]&amp;&amp;rt)</span><br><span class="line">            rt=ac.fail[rt];</span><br><span class="line">        rt=tr[rt][<span class="built_in">mp</span>(i)];<span class="comment">//访问到了trie上以i结尾这个点</span></span><br><span class="line"><span class="comment">//        fprintf(stderr,&quot;now = %d,\n&quot;,ac.dfn[rt]);</span></span><br><span class="line">        bit.<span class="built_in">radd</span>(ac.dfn[rt],ac.dfn[rt],<span class="number">1</span>);<span class="comment">//这个状态被匹配一次,</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;i:rec2)</span><br><span class="line">        cout&lt;&lt;<span class="built_in">get</span>(i)&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 2021-06-01-20.35.03</span></span><br><span class="line"><span class="comment"> * C:\Users\dell\Desktop\C++\OJ\洛谷\字符串\P5357 【模板】AC自动机（二次加强版）(fail树dfs序线段树).cpp</span></span><br><span class="line"><span class="comment"> * 在fail树上做文章</span></span><br><span class="line"><span class="comment"> * 这个modify单点修改,对于一个点,他子树上匹配点的总数即为这个点的匹配数</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="黑龙江省赛-E-Elastic-Search"><a href="#黑龙江省赛-E-Elastic-Search" class="headerlink" title="黑龙江省赛 E.Elastic Search"></a><a target="_blank" rel="noopener" href="https://codeforces.ml/gym/103107/problem/E">黑龙江省赛 E.Elastic Search</a></h4><p>题意：n个串，可打乱顺序求一个最长序列长度，使得每一个串都是前面的串的子串。</p>
<p>将所有串插入字典树并记录对应编号，一个串的子串长度不会大于它本身长度，所以按长度从大到小枚举每一个串。</p>
<p>若一个串 $a$ 为串 $b$ 的一个子串，则 $b$ 串一定存在至少一个前缀串 $p$ 在 $a$ 串的 $fail$ 子树上。令 $dp[b]$ 表示以串 $b$ 结尾的最长序列长度，那么我们只要将 $b$ 的每一个前缀串 $p$ 在 $fail$ 树上<strong>对应的点</strong>的权值更新为 $dp[b]$ ，即可通过查询子树最值来获得以某一个串为结尾的最长序列长度。</p>
<p>这样我们可以通过查询 $a$ 的 $fail$ 子树最值+1来确定 $dp[a]$，同时在 $trie$ 上按顺序访问 $a$ 的前缀串 $p$ ，将所有对应的 $fail$ 节点更新并记录全局最值即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span>  M = <span class="number">26</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AhoCorasickAutomaton</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> trie[maxn][M],isw[maxn],fail[maxn],siz;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span><span class="comment">//fail指向当前状态的最长后缀状态</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        siz=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(trie[<span class="number">0</span>],<span class="number">0</span>,<span class="built_in">sizeof</span>(trie[<span class="number">0</span>]));</span><br><span class="line">        <span class="built_in">memset</span>(isw,<span class="number">0</span>,<span class="built_in">sizeof</span>(isw));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">mp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;ch)</span></span>&#123;<span class="keyword">return</span> (<span class="type">int</span>)(ch-<span class="string">&#x27;a&#x27;</span>);&#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">Insert</span><span class="params">(string &amp;str)</span><span class="comment">//rt传入0</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//trie插入模式串</span></span><br><span class="line">        <span class="type">int</span> rt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;i:str)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> id = <span class="built_in">mp</span>(i);</span><br><span class="line">            <span class="keyword">if</span>(!trie[rt][id])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">memset</span>(trie[siz],<span class="number">0</span>,<span class="built_in">sizeof</span>(trie[siz]));</span><br><span class="line">                trie[rt][id]=siz++;</span><br><span class="line">            &#125;</span><br><span class="line">            rt = trie[rt][id];</span><br><span class="line">        &#125;</span><br><span class="line">        isw[rt]++;<span class="comment">//标记这个点为结尾</span></span><br><span class="line">        <span class="keyword">return</span> rt;<span class="comment">//返回</span></span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;G[maxn];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span><span class="comment">//构造fail指针</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; Q;</span><br><span class="line">        fail[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> id=<span class="number">0</span>,rt;id&lt;M;id++)</span><br><span class="line">        &#123;</span><br><span class="line">            rt=trie[<span class="number">0</span>][id];</span><br><span class="line">            <span class="keyword">if</span>(rt)<span class="comment">//将根节点子节点入队</span></span><br><span class="line">            &#123;</span><br><span class="line">                Q.<span class="built_in">push</span>(rt);</span><br><span class="line">                fail[rt]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> rt=Q.<span class="built_in">front</span>();<span class="comment">//fail[rt]在之前已构建完毕</span></span><br><span class="line">            Q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> id=<span class="number">0</span>;id&lt;M;id++)<span class="comment">//枚举所有子节点</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> v=trie[rt][id];</span><br><span class="line">                <span class="keyword">if</span>(v)<span class="comment">//该号子节点存在</span></span><br><span class="line">                &#123;</span><br><span class="line">                    fail[v]=trie[fail[rt]][id];</span><br><span class="line">                    Q.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span><span class="comment">//将不存在的字典树的状态链接到了失配指针的对应状态</span></span><br><span class="line">                    trie[rt][id]=trie[fail[rt]][id];<span class="comment">//文本串可能访问未知节点</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;siz;i++)<span class="comment">//构建fail树,根为0</span></span><br><span class="line">            G[fail[i]].<span class="built_in">push_back</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(string &amp;str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//返回文本串中有多少模式串(一个模式串只记录一次答案)</span></span><br><span class="line">        <span class="type">int</span> ret=<span class="number">0</span>,rt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> &amp;i:str)</span><br><span class="line">        &#123;</span><br><span class="line">            rt=trie[rt][<span class="built_in">mp</span>(i)];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> tmp=rt;tmp&amp;&amp;~isw[tmp];tmp=fail[tmp])</span><br><span class="line">                ret+=isw[tmp],isw[tmp]=<span class="number">-1</span>;<span class="comment">//用fail找出所有匹配模式串</span></span><br><span class="line">        &#125;<span class="comment">//匹配成功的不会再匹配</span></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> dfn[maxn],node[maxn],dfc=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dfn[x]=++dfc;</span><br><span class="line"><span class="comment">//        fprintf(stderr,&quot;%d-&gt;%d\n&quot;,dfn[fa],dfn[x]);</span></span><br><span class="line"><span class="comment">//        fprintf(stderr,&quot;dfn[%d] = %d\n&quot;,x,dfn[x]);</span></span><br><span class="line">        node[x]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;v:G[x])</span><br><span class="line">            node[x]+=<span class="built_in">dfs</span>(v,x);</span><br><span class="line">        <span class="keyword">return</span> node[x];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ac;</span><br><span class="line"><span class="type">int</span> tr[maxn][M],dp[maxn],ans=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">(<span class="type">signed</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">rec</span><span class="params">(n)</span></span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; id;</span><br><span class="line">    ac.<span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;s:rec)</span><br><span class="line">        cin&gt;&gt;s;</span><br><span class="line">    <span class="built_in">sort</span>(rec.<span class="built_in">begin</span>(),rec.<span class="built_in">end</span>(),[](<span class="type">const</span> string &amp;x,<span class="type">const</span> string &amp;y)&#123;</span><br><span class="line">            <span class="keyword">return</span> x.<span class="built_in">length</span>()&gt;y.<span class="built_in">length</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;s:rec)</span><br><span class="line">        id.<span class="built_in">push_back</span>(ac.<span class="built_in">Insert</span>(s));</span><br><span class="line">    <span class="built_in">memcpy</span>(tr[<span class="number">0</span>],ac.trie[<span class="number">0</span>],<span class="built_in">sizeof</span>(<span class="type">int</span>)*maxn*M);</span><br><span class="line">    ac.<span class="built_in">build</span>();</span><br><span class="line">    ac.<span class="built_in">dfs</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> mp(ch) (int)(ch-<span class="string">&#x27;a&#x27;</span>)</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> now=T.<span class="built_in">querymax</span>(ac.dfn[id[i]],ac.dfn[id[i]]+ac.node[id[i]]<span class="number">-1</span>)+<span class="number">1</span>;</span><br><span class="line">        ans=<span class="built_in">max</span>(ans,now);<span class="comment">//T是动态开点线段树模板</span></span><br><span class="line">        dp[i]=now;</span><br><span class="line">        <span class="type">int</span> rt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;ch:rec[i])</span><br><span class="line">        &#123;<span class="comment">//将第i个串的每一个前缀都在fail树上更新答案,方便之后取子树最值</span></span><br><span class="line">            <span class="keyword">while</span>(!tr[rt][<span class="built_in">mp</span>(ch)]&amp;&amp;rt)</span><br><span class="line">                rt=ac.fail[rt];</span><br><span class="line">            rt=tr[rt][<span class="built_in">mp</span>(ch)];<span class="comment">//访问到了trie上以i结尾这个点</span></span><br><span class="line">            <span class="type">int</span> pre=T.<span class="built_in">querymax</span>(ac.dfn[rt],ac.dfn[rt]);<span class="comment">//更新为新的dp值</span></span><br><span class="line">            T.<span class="built_in">modify</span>(ac.dfn[rt],ac.dfn[rt],now-pre);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 2021-05-30-12.14.13</span></span><br><span class="line"><span class="comment"> * n个串,求一个最长序列,每一个串都是前面的串的子串</span></span><br><span class="line"><span class="comment"> * 若a为b的子串</span></span><br><span class="line"><span class="comment"> * 则b在trie上一定存在某一节点必定在a的fail子树上,将这些点插入的时候节点权值全部+1</span></span><br><span class="line"><span class="comment"> * bcd abcde ,则abcd在bcd的fail子树上</span></span><br><span class="line"><span class="comment"> * 因为我们必定可以通过去掉一个串的前缀与后缀来得到他的任意子串</span></span><br><span class="line"><span class="comment"> * 按照长度排序,dp[i]表示以第i个子串结尾的最长序列</span></span><br><span class="line"><span class="comment"> * 线段树维护子树上的最大dp值,将所有前缀节点都在fail(后缀)树上更新</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h3 id="后缀数组"><a href="#后缀数组" class="headerlink" title="后缀数组"></a>后缀数组</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span></span><br><span class="line">&#123;<span class="comment">//倍增算法 O(nlogn)</span></span><br><span class="line">    <span class="type">int</span> n;<span class="comment">//包括末尾0在内的字符数</span></span><br><span class="line">    <span class="type">int</span> Rank[MAXN], height[MAXN], sa[MAXN], r[MAXN];</span><br><span class="line">    <span class="comment">//rnk从0开始</span></span><br><span class="line">    <span class="comment">//sa从1开始,因为最后一个字符(最小的)排在第0位</span></span><br><span class="line">    <span class="comment">//height从1开始,因为表示的是sa[i - 1]和sa[i]</span></span><br><span class="line">    <span class="type">int</span> wa[MAXN], wb[MAXN], wv[MAXN], ws_[MAXN];</span><br><span class="line">    <span class="comment">//Suffix函数的参数m代表字符串中字符的取值范围,是基数排序的一个参数,如果原序列都是字母可以直接取128,如果原序列本身都是整数的话,则m可以取比最大的整数大1的值</span></span><br><span class="line">    <span class="comment">//待排序的字符串放在r数组中,从r[0]到r[n-1]，长度为n</span></span><br><span class="line">    <span class="comment">//为了方便比较大小,可以在字符串后面添加一个字符,这个字符没有在前面的字符中出现过,而且比前面的字符都要小</span></span><br><span class="line">    <span class="comment">//同上,为了函数操作的方便,约定除r[n-1]外所有的r[i]都大于0,r[n-1]=0</span></span><br><span class="line">    <span class="comment">//函数结束后,结果放在sa数组中,从sa[0]到sa[n-1],sa[0]=n-1</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Suffix</span><span class="params">(<span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> i, j, k, *x = wa, *y = wb, *t;</span><br><span class="line">        <span class="comment">//对长度为1的字符串排序</span></span><br><span class="line">        <span class="comment">//一般来说,在字符串的题目中,r的最大值不会很大,所以这里使用了基数排序</span></span><br><span class="line">        <span class="comment">//如果r的最大值很大,那么把这段代码改成快速排序</span></span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; m; ++i) ws_[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; ++i) ws_[x[i] = r[i]]++;<span class="comment">//统计字符的个数</span></span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; m; ++i) ws_[i] += ws_[i - <span class="number">1</span>];<span class="comment">//统计不大于字符i的字符个数</span></span><br><span class="line">        <span class="keyword">for</span>(i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) sa[--ws_[x[i]]] = i;<span class="comment">//计算字符排名</span></span><br><span class="line">        <span class="comment">//基数排序</span></span><br><span class="line">        <span class="comment">//x数组保存的值相当于是rank值</span></span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">1</span>, k = <span class="number">1</span>; k &lt; n; j&lt;&lt;=<span class="number">1</span>, m = k)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//j是当前字符串的长度,数组y保存的是对第二关键字排序的结果</span></span><br><span class="line">            <span class="comment">//第二关键字排序</span></span><br><span class="line">            <span class="keyword">for</span>(k = <span class="number">0</span>, i = n - j; i &lt; n; ++i) y[k++] = i;<span class="comment">//第二关键字为0的排在前面</span></span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; ++i) <span class="keyword">if</span>(sa[i] &gt;= j) y[k++] = sa[i] - j;<span class="comment">//长度为j的子串sa[i]应该是长度为2 * j的子串sa[i] - j的后缀（第二关键字）,对所有的长度为2 * j的子串根据第二关键字来排序</span></span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; ++i) wv[i] = x[y[i]];<span class="comment">//提取第一关键字</span></span><br><span class="line">            <span class="comment">//按第一关键字排序 (原理同对长度为1的字符串排序)</span></span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; m; ++i) ws_[i] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; ++i) ws_[wv[i]]++;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; m; ++i) ws_[i] += ws_[i - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span>(i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) sa[--ws_[wv[i]]] = y[i];<span class="comment">//按第一关键字,计算出了长度为2 * j的子串排名情况</span></span><br><span class="line">            <span class="comment">//此时数组x是长度为j的子串的排名情况,数组y仍是根据第二关键字排序后的结果</span></span><br><span class="line">            <span class="comment">//计算长度为2 * j的子串的排名情况,保存到数组x</span></span><br><span class="line">            t = x;</span><br><span class="line">            x = y;</span><br><span class="line">            y = t;</span><br><span class="line">            <span class="keyword">for</span>(x[sa[<span class="number">0</span>]] = <span class="number">0</span>, i = k = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">                x[sa[i]] = (y[sa[i - <span class="number">1</span>]] == y[sa[i]] &amp;&amp; y[sa[i - <span class="number">1</span>] + j] == y[sa[i] + j]) ? k - <span class="number">1</span> : k++;</span><br><span class="line">            <span class="comment">//若长度为2 * j的子串sa[i]与sa[i - 1]完全相同,则他们有相同的排名</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build_height</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> i, j, k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            Rank[sa[i]] = i;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(k) k--;</span><br><span class="line">            <span class="type">int</span> j = sa[Rank[i]<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">while</span>(r[i+k] == r[j+k]) k++;</span><br><span class="line">            height[Rank[i]] = k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">debug</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; 名次 下标  height  后缀串\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%5d%5d%5d     &quot;</span>,i,sa[i],height[i]);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=sa[i];j&lt;n;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%-3d &quot;</span>,r[j]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; sa;</span><br></pre></td></tr></table></figure>

<h3 id="性能不是很好的大数计算模板"><a href="#性能不是很好的大数计算模板" class="headerlink" title="性能不是很好的大数计算模板"></a>性能不是很好的<strong>大数计算</strong>模板</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> Length=<span class="number">10005</span>;</span><br><span class="line"><span class="function">string <span class="title">add</span><span class="params">(<span class="type">const</span> string &amp;a,<span class="type">const</span> string &amp;b)</span><span class="comment">//加</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string ans;</span><br><span class="line">    <span class="type">int</span> na[Length]=&#123;<span class="number">0</span>&#125;,nb[Length]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> la=a.<span class="built_in">size</span>(),lb=b.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;la;i++) na[la<span class="number">-1</span>-i]=a[i]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lb;i++) nb[lb<span class="number">-1</span>-i]=b[i]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="type">int</span> lmax=la&gt;lb?la:lb;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lmax;i++) na[i]+=nb[i],na[i+<span class="number">1</span>]+=na[i]/<span class="number">10</span>,na[i]%=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">if</span>(na[lmax]) lmax++;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=lmax<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) ans+=na[i]+<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">string <span class="title">mul</span><span class="params">(<span class="type">const</span> string &amp;a,<span class="type">const</span> string &amp;b)</span><span class="comment">//乘</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string s;</span><br><span class="line">    <span class="type">int</span> na[Length],nb[Length],nc[Length],La=a.<span class="built_in">size</span>(),Lb=b.<span class="built_in">size</span>();<span class="comment">//na存储被乘数，nb存储乘数，nc存储积</span></span><br><span class="line">    <span class="built_in">fill</span>(na,na+Length,<span class="number">0</span>);<span class="built_in">fill</span>(nb,nb+Length,<span class="number">0</span>);<span class="built_in">fill</span>(nc,nc+Length,<span class="number">0</span>);<span class="comment">//将na,nb,nc都置为0</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=La<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) na[La-i]=a[i]-<span class="string">&#x27;0&#x27;</span>;<span class="comment">//将字符串表示的大整形数转成i整形数组表示的大整形数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=Lb<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) nb[Lb-i]=b[i]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=La;i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Lb;j++)</span><br><span class="line">        nc[i+j<span class="number">-1</span>]+=na[i]*nb[j];<span class="comment">//a的第i位乘以b的第j位为积的第i+j-1位（先不考虑进位）</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=La+Lb;i++)</span><br><span class="line">        nc[i+<span class="number">1</span>]+=nc[i]/<span class="number">10</span>,nc[i]%=<span class="number">10</span>;<span class="comment">//统一处理进位</span></span><br><span class="line">    <span class="keyword">if</span>(nc[La+Lb]) s+=nc[La+Lb]+<span class="string">&#x27;0&#x27;</span>;<span class="comment">//判断第i+j位上的数字是不是0</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=La+Lb<span class="number">-1</span>;i&gt;=<span class="number">1</span>;i--)</span><br><span class="line">        s+=nc[i]+<span class="string">&#x27;0&#x27;</span>;<span class="comment">//将整形数组转成字符串</span></span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> *b,<span class="type">int</span> La,<span class="type">int</span> Lb)</span><span class="comment">//差</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(La&lt;Lb)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//如果a小于b，则返回-1</span></span><br><span class="line">    <span class="keyword">if</span>(La==Lb)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=La<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">            <span class="keyword">if</span>(a[i]&gt;b[i])</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(a[i]&lt;b[i])</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//如果a小于b，则返回-1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;La;i++)<span class="comment">//高精度减法</span></span><br><span class="line">    &#123;</span><br><span class="line">        a[i]-=b[i];</span><br><span class="line">        <span class="keyword">if</span>(a[i]&lt;<span class="number">0</span>)</span><br><span class="line">            a[i]+=<span class="number">10</span>,a[i+<span class="number">1</span>]--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=La<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">        <span class="keyword">if</span>(a[i])</span><br><span class="line">            <span class="keyword">return</span> i+<span class="number">1</span>;<span class="comment">//返回差的位数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//返回差的位数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function">string <span class="title">div</span><span class="params">(<span class="type">const</span> string &amp;n1,<span class="type">const</span> string &amp;n2,<span class="type">int</span> nn)</span><span class="comment">//n1,n2是字符串表示的被除数，除数,nn是选择返回商还是余数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string s,v;<span class="comment">//s存商,v存余数</span></span><br><span class="line">    <span class="type">int</span> a[Length],b[Length],r[Length],La=n1.<span class="built_in">size</span>(),Lb=n2.<span class="built_in">size</span>(),i,tp=La;<span class="comment">//a，b是整形数组表示被除数，除数，tp保存被除数的长度</span></span><br><span class="line">    <span class="built_in">fill</span>(a,a+Length,<span class="number">0</span>);<span class="built_in">fill</span>(b,b+Length,<span class="number">0</span>);<span class="built_in">fill</span>(r,r+Length,<span class="number">0</span>);<span class="comment">//数组元素都置为0</span></span><br><span class="line">    <span class="keyword">for</span>(i=La<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) a[La<span class="number">-1</span>-i]=n1[i]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=Lb<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) b[Lb<span class="number">-1</span>-i]=n2[i]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(La&lt;Lb || (La==Lb &amp;&amp; n1&lt;n2))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//cout&lt;&lt;0&lt;&lt;endl;</span></span><br><span class="line">        <span class="keyword">return</span> n1;</span><br><span class="line">    &#125;<span class="comment">//如果a&lt;b,则商为0，余数为被除数</span></span><br><span class="line">    <span class="type">int</span> t=La-Lb;<span class="comment">//除被数和除数的位数之差</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=La<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)<span class="comment">//将除数扩大10^t倍</span></span><br><span class="line">        <span class="keyword">if</span>(i&gt;=t)</span><br><span class="line">            b[i]=b[i-t];</span><br><span class="line">        <span class="keyword">else</span> b[i]=<span class="number">0</span>;</span><br><span class="line">     Lb=La;</span><br><span class="line">     <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=t;j++)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="type">int</span> temp;</span><br><span class="line">         <span class="keyword">while</span>((temp=<span class="built_in">sub</span>(a,b+j,La,Lb-j))&gt;=<span class="number">0</span>)<span class="comment">//如果被除数比除数大继续减</span></span><br><span class="line">         &#123;</span><br><span class="line">             La=temp;</span><br><span class="line">             r[t-j]++;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;Length<span class="number">-10</span>;i++)</span><br><span class="line">        r[i+<span class="number">1</span>]+=r[i]/<span class="number">10</span>,r[i]%=<span class="number">10</span>;<span class="comment">//统一处理进位</span></span><br><span class="line">     <span class="keyword">while</span>(!r[i]) i--;<span class="comment">//将整形数组表示的商转化成字符串表示的</span></span><br><span class="line">     <span class="keyword">while</span>(i&gt;=<span class="number">0</span>) s+=r[i--]+<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">     <span class="comment">//cout&lt;&lt;s&lt;&lt;endl;</span></span><br><span class="line">     i=tp;</span><br><span class="line">     <span class="keyword">while</span>(!a[i]) i--;<span class="comment">//将整形数组表示的余数转化成字符串表示的&lt;/span&gt;</span></span><br><span class="line">     <span class="keyword">while</span>(i&gt;=<span class="number">0</span>) v+=a[i--]+<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">     <span class="keyword">if</span>(v.<span class="built_in">empty</span>()) v=<span class="string">&quot;0&quot;</span>;</span><br><span class="line">     <span class="comment">//cout&lt;&lt;v&lt;&lt;endl;</span></span><br><span class="line">     <span class="keyword">if</span>(nn==<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">     <span class="keyword">if</span>(nn==<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">judge</span><span class="params">(<span class="type">const</span> string &amp;s)</span><span class="comment">//判断s是否为全0串</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;s.<span class="built_in">size</span>();i++)</span><br><span class="line">        <span class="keyword">if</span>(s[i]!=<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">string <span class="title">gcd</span><span class="params">(string a,string b)</span><span class="comment">//求最大公约数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a.<span class="built_in">length</span>()&lt;b.<span class="built_in">length</span>())</span><br><span class="line">        <span class="built_in">swap</span>(a,b);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(a&lt;b)</span><br><span class="line">        <span class="built_in">swap</span>(a,b);</span><br><span class="line">    string t;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">judge</span>(b))<span class="comment">//如果余数不为0，继续除</span></span><br><span class="line">    &#123;</span><br><span class="line">        t=a;<span class="comment">//保存被除数的值</span></span><br><span class="line">        a=b;<span class="comment">//用除数替换被除数</span></span><br><span class="line">        b=<span class="built_in">div</span>(t,b,<span class="number">2</span>);<span class="comment">//用余数替换除数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="大数模板"><a href="#大数模板" class="headerlink" title="大数模板"></a>大数模板</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// base and base_digits must be consistent</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> base = <span class="number">1000000000</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> base_digits = <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">bigint</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// value == 0 is represented by empty z</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; z; <span class="comment">// digits</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// sign == 1 &lt;==&gt; value &gt;= 0</span></span><br><span class="line">    <span class="comment">// sign == -1 &lt;==&gt; value &lt; 0</span></span><br><span class="line">    <span class="type">int</span> sign;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">bigint</span>() : <span class="built_in">sign</span>(<span class="number">1</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">bigint</span>(<span class="type">long</span> <span class="type">long</span> v) &#123; *<span class="keyword">this</span> = v; &#125;</span><br><span class="line"></span><br><span class="line">    bigint&amp; <span class="keyword">operator</span>=(<span class="type">long</span> <span class="type">long</span> v)</span><br><span class="line">    &#123;</span><br><span class="line">        sign = v &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">        v *= sign;</span><br><span class="line">        z.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="keyword">for</span> (; v &gt; <span class="number">0</span>; v = v / base)</span><br><span class="line">            z.<span class="built_in">push_back</span>((<span class="type">int</span>)(v % base));</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">bigint</span>(<span class="type">const</span> string&amp; s) &#123; <span class="built_in">read</span>(s); &#125;</span><br><span class="line"></span><br><span class="line">    bigint&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> bigint&amp; other)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (sign == other.sign)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, carry = <span class="number">0</span>; i &lt; other.z.<span class="built_in">size</span>() || carry; ++i)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (i == z.<span class="built_in">size</span>())</span><br><span class="line">                    z.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">                z[i] += carry + (i &lt; other.z.<span class="built_in">size</span>() ? other.z[i] : <span class="number">0</span>);</span><br><span class="line">                carry = z[i] &gt;= base;</span><br><span class="line">                <span class="keyword">if</span> (carry)</span><br><span class="line">                    z[i] -= base;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (other != <span class="number">0</span> <span class="comment">/* prevent infinite loop */</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            *<span class="keyword">this</span> -= -other;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> bigint <span class="keyword">operator</span>+(bigint a, <span class="type">const</span> bigint&amp; b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> a += b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bigint&amp; <span class="keyword">operator</span>-=(<span class="type">const</span> bigint&amp; other)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (sign == other.sign)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (sign == <span class="number">1</span> &amp;&amp; *<span class="keyword">this</span> &gt;= other || sign == <span class="number">-1</span> &amp;&amp; *<span class="keyword">this</span> &lt;= other)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, carry = <span class="number">0</span>; i &lt; other.z.<span class="built_in">size</span>() || carry; ++i)</span><br><span class="line">                &#123;</span><br><span class="line">                    z[i] -= carry + (i &lt; other.z.<span class="built_in">size</span>() ? other.z[i] : <span class="number">0</span>);</span><br><span class="line">                    carry = z[i] &lt; <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">if</span> (carry)</span><br><span class="line">                        z[i] += base;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">trim</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                *<span class="keyword">this</span> = other - *<span class="keyword">this</span>;</span><br><span class="line">                <span class="keyword">this</span>-&gt;sign = -<span class="keyword">this</span>-&gt;sign;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            *<span class="keyword">this</span> += -other;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> bigint <span class="keyword">operator</span>-(bigint a, <span class="type">const</span> bigint&amp; b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> a -= b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bigint&amp; <span class="keyword">operator</span>*=(<span class="type">int</span> v)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (v &lt; <span class="number">0</span>)</span><br><span class="line">            sign = -sign, v = -v;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, carry = <span class="number">0</span>; i &lt; z.<span class="built_in">size</span>() || carry; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == z.<span class="built_in">size</span>())</span><br><span class="line">                z.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="type">long</span> <span class="type">long</span> cur = (<span class="type">long</span> <span class="type">long</span>)z[i] * v + carry;</span><br><span class="line">            carry = (<span class="type">int</span>)(cur / base);</span><br><span class="line">            z[i] = (<span class="type">int</span>)(cur % base);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">trim</span>();</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bigint <span class="keyword">operator</span>*(<span class="type">int</span> v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bigint</span>(*<span class="keyword">this</span>) *= v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> pair&lt;bigint, bigint&gt; <span class="title">divmod</span><span class="params">(<span class="type">const</span> bigint&amp; a1, <span class="type">const</span> bigint&amp; b1)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> norm = base / (b1.z.<span class="built_in">back</span>() + <span class="number">1</span>);</span><br><span class="line">        bigint a = a1.<span class="built_in">abs</span>() * norm;</span><br><span class="line">        bigint b = b1.<span class="built_in">abs</span>() * norm;</span><br><span class="line">        bigint q, r;</span><br><span class="line">        q.z.<span class="built_in">resize</span>(a.z.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = (<span class="type">int</span>)a.z.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        &#123;</span><br><span class="line">            r *= base;</span><br><span class="line">            r += a.z[i];</span><br><span class="line">            <span class="type">int</span> s1 = b.z.<span class="built_in">size</span>() &lt; r.z.<span class="built_in">size</span>() ? r.z[b.z.<span class="built_in">size</span>()] : <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> s2 = b.z.<span class="built_in">size</span>() - <span class="number">1</span> &lt; r.z.<span class="built_in">size</span>() ? r.z[b.z.<span class="built_in">size</span>() - <span class="number">1</span>] : <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> d = (<span class="type">int</span>)(((<span class="type">long</span> <span class="type">long</span>)s1 * base + s2) / b.z.<span class="built_in">back</span>());</span><br><span class="line">            r -= b * d;</span><br><span class="line">            <span class="keyword">while</span> (r &lt; <span class="number">0</span>)</span><br><span class="line">                r += b, --d;</span><br><span class="line">            q.z[i] = d;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        q.sign = a1.sign * b1.sign;</span><br><span class="line">        r.sign = a1.sign;</span><br><span class="line">        q.<span class="built_in">trim</span>();</span><br><span class="line">        r.<span class="built_in">trim</span>();</span><br><span class="line">        <span class="keyword">return</span> &#123;q, r / norm&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> bigint <span class="title">sqrt</span><span class="params">(<span class="type">const</span> bigint&amp; a1)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        bigint a = a1;</span><br><span class="line">        <span class="keyword">while</span> (a.z.<span class="built_in">empty</span>() || a.z.<span class="built_in">size</span>() % <span class="number">2</span> == <span class="number">1</span>)</span><br><span class="line">            a.z.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> n = a.z.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> firstDigit = (<span class="type">int</span>)::<span class="built_in">sqrt</span>((<span class="type">double</span>)a.z[n - <span class="number">1</span>] * base + a.z[n - <span class="number">2</span>]);</span><br><span class="line">        <span class="type">int</span> norm = base / (firstDigit + <span class="number">1</span>);</span><br><span class="line">        a *= norm;</span><br><span class="line">        a *= norm;</span><br><span class="line">        <span class="keyword">while</span> (a.z.<span class="built_in">empty</span>() || a.z.<span class="built_in">size</span>() % <span class="number">2</span> == <span class="number">1</span>)</span><br><span class="line">            a.z.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        bigint r = (<span class="type">long</span> <span class="type">long</span>)a.z[n - <span class="number">1</span>] * base + a.z[n - <span class="number">2</span>];</span><br><span class="line">        firstDigit = (<span class="type">int</span>)::<span class="built_in">sqrt</span>((<span class="type">double</span>)a.z[n - <span class="number">1</span>] * base + a.z[n - <span class="number">2</span>]);</span><br><span class="line">        <span class="type">int</span> q = firstDigit;</span><br><span class="line">        bigint res;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = n / <span class="number">2</span> - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (;; --q)</span><br><span class="line">            &#123;</span><br><span class="line">                bigint r1 = (r - (res * <span class="number">2</span> * base + q) * q) * base * base + (j &gt; <span class="number">0</span> ? (<span class="type">long</span> <span class="type">long</span>)a.z[<span class="number">2</span> * j - <span class="number">1</span>] * base + a.z[<span class="number">2</span> * j - <span class="number">2</span>] : <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (r1 &gt;= <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    r = r1;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            res *= base;</span><br><span class="line">            res += q;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (j &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> d1 = res.z.<span class="built_in">size</span>() + <span class="number">2</span> &lt; r.z.<span class="built_in">size</span>() ? r.z[res.z.<span class="built_in">size</span>() + <span class="number">2</span>] : <span class="number">0</span>;</span><br><span class="line">                <span class="type">int</span> d2 = res.z.<span class="built_in">size</span>() + <span class="number">1</span> &lt; r.z.<span class="built_in">size</span>() ? r.z[res.z.<span class="built_in">size</span>() + <span class="number">1</span>] : <span class="number">0</span>;</span><br><span class="line">                <span class="type">int</span> d3 = res.z.<span class="built_in">size</span>() &lt; r.z.<span class="built_in">size</span>() ? r.z[res.z.<span class="built_in">size</span>()] : <span class="number">0</span>;</span><br><span class="line">                q = (<span class="type">int</span>)(((<span class="type">long</span> <span class="type">long</span>)d1 * base * base + (<span class="type">long</span> <span class="type">long</span>)d2 * base + d3) / (firstDigit * <span class="number">2</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        res.<span class="built_in">trim</span>();</span><br><span class="line">        <span class="keyword">return</span> res / norm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bigint <span class="keyword">operator</span>/(<span class="type">const</span> bigint&amp; v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">divmod</span>(*<span class="keyword">this</span>, v).first;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bigint <span class="keyword">operator</span>%(<span class="type">const</span> bigint&amp; v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">divmod</span>(*<span class="keyword">this</span>, v).second;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bigint&amp; <span class="keyword">operator</span>/=(<span class="type">int</span> v)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (v &lt; <span class="number">0</span>)</span><br><span class="line">            sign = -sign, v = -v;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = (<span class="type">int</span>)z.<span class="built_in">size</span>() - <span class="number">1</span>, rem = <span class="number">0</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">long</span> <span class="type">long</span> cur = z[i] + rem * (<span class="type">long</span> <span class="type">long</span>)base;</span><br><span class="line">            z[i] = (<span class="type">int</span>)(cur / v);</span><br><span class="line">            rem = (<span class="type">int</span>)(cur % v);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">trim</span>();</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bigint <span class="keyword">operator</span>/(<span class="type">int</span> v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bigint</span>(*<span class="keyword">this</span>) /= v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="keyword">operator</span>%(<span class="type">int</span> v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (v &lt; <span class="number">0</span>)</span><br><span class="line">            v = -v;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = (<span class="type">int</span>)z.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">            m = (<span class="type">int</span>)((z[i] + m * (<span class="type">long</span> <span class="type">long</span>)base) % v);</span><br><span class="line">        <span class="keyword">return</span> m * sign;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bigint&amp; <span class="keyword">operator</span>*=(<span class="type">const</span> bigint&amp; v)</span><br><span class="line">    &#123;</span><br><span class="line">        *<span class="keyword">this</span> = *<span class="keyword">this</span> * v;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bigint&amp; <span class="keyword">operator</span>/=(<span class="type">const</span> bigint&amp; v)</span><br><span class="line">    &#123;</span><br><span class="line">        *<span class="keyword">this</span> = *<span class="keyword">this</span> / v;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> bigint&amp; v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (sign != v.sign)</span><br><span class="line">            <span class="keyword">return</span> sign &lt; v.sign;</span><br><span class="line">        <span class="keyword">if</span> (z.<span class="built_in">size</span>() != v.z.<span class="built_in">size</span>())</span><br><span class="line">            <span class="keyword">return</span> z.<span class="built_in">size</span>() * sign &lt; v.z.<span class="built_in">size</span>() * v.sign;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = (<span class="type">int</span>)z.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            <span class="keyword">if</span> (z[i] != v.z[i])</span><br><span class="line">                <span class="keyword">return</span> z[i] * sign &lt; v.z[i] * sign;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&gt;(<span class="type">const</span> bigint&amp; v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> v &lt; *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;=(<span class="type">const</span> bigint&amp; v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> !(v &lt; *<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&gt;=(<span class="type">const</span> bigint&amp; v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> !(*<span class="keyword">this</span> &lt; v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> bigint&amp; v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> !(*<span class="keyword">this</span> &lt; v) &amp;&amp; !(v &lt; *<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>!=(<span class="type">const</span> bigint&amp; v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span> &lt; v || v &lt; *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">trim</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (!z.<span class="built_in">empty</span>() &amp;&amp; z.<span class="built_in">back</span>() == <span class="number">0</span>)</span><br><span class="line">            z.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="keyword">if</span> (z.<span class="built_in">empty</span>())</span><br><span class="line">            sign = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isZero</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> z.<span class="built_in">empty</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> bigint <span class="keyword">operator</span>-(bigint v)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!v.z.<span class="built_in">empty</span>())</span><br><span class="line">            v.sign = -v.sign;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">bigint <span class="title">abs</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sign == <span class="number">1</span> ? *<span class="keyword">this</span> : -*<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">longValue</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = (<span class="type">int</span>)z.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            res = res * base + z[i];</span><br><span class="line">        <span class="keyword">return</span> res * sign;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> bigint <span class="title">gcd</span><span class="params">(<span class="type">const</span> bigint&amp; a, <span class="type">const</span> bigint&amp; b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.<span class="built_in">isZero</span>() ? a : <span class="built_in">gcd</span>(b, a % b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> bigint <span class="title">lcm</span><span class="params">(<span class="type">const</span> bigint&amp; a, <span class="type">const</span> bigint&amp; b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a / <span class="built_in">gcd</span>(a, b) * b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(<span class="type">const</span> string&amp; s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        sign = <span class="number">1</span>;</span><br><span class="line">        z.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="type">int</span> pos = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (pos &lt; s.<span class="built_in">size</span>() &amp;&amp; (s[pos] == <span class="string">&#x27;-&#x27;</span> || s[pos] == <span class="string">&#x27;+&#x27;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[pos] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                sign = -sign;</span><br><span class="line">            ++pos;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = (<span class="type">int</span>)s.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= pos; i -= base_digits)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="built_in">max</span>(pos, i - base_digits + <span class="number">1</span>); j &lt;= i; j++)</span><br><span class="line">                x = x * <span class="number">10</span> + s[j] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            z.<span class="built_in">push_back</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">trim</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> istream&amp; <span class="keyword">operator</span>&gt;&gt;(istream&amp; stream, bigint&amp; v)</span><br><span class="line">    &#123;</span><br><span class="line">        string s;</span><br><span class="line">        stream &gt;&gt; s;</span><br><span class="line">        v.<span class="built_in">read</span>(s);</span><br><span class="line">        <span class="keyword">return</span> stream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> ostream&amp; <span class="keyword">operator</span>&lt;&lt;(ostream&amp; stream, <span class="type">const</span> bigint&amp; v)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (v.sign == <span class="number">-1</span>)</span><br><span class="line">            stream &lt;&lt; <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">        stream &lt;&lt; (v.z.<span class="built_in">empty</span>() ? <span class="number">0</span> : v.z.<span class="built_in">back</span>());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = (<span class="type">int</span>)v.z.<span class="built_in">size</span>() - <span class="number">2</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">            stream &lt;&lt; <span class="built_in">setw</span>(base_digits) &lt;&lt; <span class="built_in">setfill</span>(<span class="string">&#x27;0&#x27;</span>) &lt;&lt; v.z[i];</span><br><span class="line">        <span class="keyword">return</span> stream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> vector&lt;<span class="type">int</span>&gt; <span class="title">convert_base</span><span class="params">(<span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; a, <span class="type">int</span> old_digits, <span class="type">int</span> new_digits)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">long</span> <span class="type">long</span>&gt; <span class="title">p</span><span class="params">(max(old_digits, new_digits) + <span class="number">1</span>)</span></span>;</span><br><span class="line">        p[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; p.<span class="built_in">size</span>(); i++)</span><br><span class="line">            p[i] = p[i - <span class="number">1</span>] * <span class="number">10</span>;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> cur = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> cur_digits = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> v : a)</span><br><span class="line">        &#123;</span><br><span class="line">            cur += v * p[cur_digits];</span><br><span class="line">            cur_digits += old_digits;</span><br><span class="line">            <span class="keyword">while</span> (cur_digits &gt;= new_digits)</span><br><span class="line">            &#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(<span class="built_in">int</span>(cur % p[new_digits]));</span><br><span class="line">                cur /= p[new_digits];</span><br><span class="line">                cur_digits -= new_digits;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="built_in">push_back</span>((<span class="type">int</span>)cur);</span><br><span class="line">        <span class="keyword">while</span> (!res.<span class="built_in">empty</span>() &amp;&amp; res.<span class="built_in">back</span>() == <span class="number">0</span>)</span><br><span class="line">            res.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> vector&lt;<span class="type">long</span> <span class="type">long</span>&gt; vll;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> vll <span class="title">karatsubaMultiply</span><span class="params">(<span class="type">const</span> vll&amp; a, <span class="type">const</span> vll&amp; b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = a.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vll <span class="title">res</span><span class="params">(n + n)</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">32</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">                    res[i + j] += a[i] * b[j];</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> k = n &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="function">vll <span class="title">a1</span><span class="params">(a.begin(), a.begin() + k)</span></span>;</span><br><span class="line">        <span class="function">vll <span class="title">a2</span><span class="params">(a.begin() + k, a.end())</span></span>;</span><br><span class="line">        <span class="function">vll <span class="title">b1</span><span class="params">(b.begin(), b.begin() + k)</span></span>;</span><br><span class="line">        <span class="function">vll <span class="title">b2</span><span class="params">(b.begin() + k, b.end())</span></span>;</span><br><span class="line"></span><br><span class="line">        vll a1b1 = <span class="built_in">karatsubaMultiply</span>(a1, b1);</span><br><span class="line">        vll a2b2 = <span class="built_in">karatsubaMultiply</span>(a2, b2);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++)</span><br><span class="line">            a2[i] += a1[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++)</span><br><span class="line">            b2[i] += b1[i];</span><br><span class="line"></span><br><span class="line">        vll r = <span class="built_in">karatsubaMultiply</span>(a2, b2);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a1b1.<span class="built_in">size</span>(); i++)</span><br><span class="line">            r[i] -= a1b1[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a2b2.<span class="built_in">size</span>(); i++)</span><br><span class="line">            r[i] -= a2b2[i];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; r.<span class="built_in">size</span>(); i++)</span><br><span class="line">            res[i + k] += r[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a1b1.<span class="built_in">size</span>(); i++)</span><br><span class="line">            res[i] += a1b1[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a2b2.<span class="built_in">size</span>(); i++)</span><br><span class="line">            res[i + n] += a2b2[i];</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bigint <span class="keyword">operator</span>*(<span class="type">const</span> bigint&amp; v) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; a6 = <span class="built_in">convert_base</span>(<span class="keyword">this</span>-&gt;z, base_digits, <span class="number">6</span>);</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; b6 = <span class="built_in">convert_base</span>(v.z, base_digits, <span class="number">6</span>);</span><br><span class="line">        <span class="function">vll <span class="title">a</span><span class="params">(a6.begin(), a6.end())</span></span>;</span><br><span class="line">        <span class="function">vll <span class="title">b</span><span class="params">(b6.begin(), b6.end())</span></span>;</span><br><span class="line">        <span class="keyword">while</span> (a.<span class="built_in">size</span>() &lt; b.<span class="built_in">size</span>())</span><br><span class="line">            a.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span> (b.<span class="built_in">size</span>() &lt; a.<span class="built_in">size</span>())</span><br><span class="line">            b.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span> (a.<span class="built_in">size</span>() &amp; (a.<span class="built_in">size</span>() - <span class="number">1</span>))</span><br><span class="line">            a.<span class="built_in">push_back</span>(<span class="number">0</span>), b.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        vll c = <span class="built_in">karatsubaMultiply</span>(a, b);</span><br><span class="line">        bigint res;</span><br><span class="line">        res.sign = sign * v.sign;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, carry = <span class="number">0</span>; i &lt; c.<span class="built_in">size</span>(); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">long</span> <span class="type">long</span> cur = c[i] + carry;</span><br><span class="line">            res.z.<span class="built_in">push_back</span>((<span class="type">int</span>)(cur % <span class="number">1000000</span>));</span><br><span class="line">            carry = (<span class="type">int</span>)(cur / <span class="number">1000000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        res.z = <span class="built_in">convert_base</span>(res.z, <span class="number">6</span>, base_digits);</span><br><span class="line">        res.<span class="built_in">trim</span>();</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF/" rel="tag"># 算法模板</a>
              <a href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" rel="tag"># 字符串</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/06/24/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AB%9E%E8%B5%9B%E7%9B%B8%E5%85%B3/%E7%8E%B0%E5%9C%A8%E7%BB%B4%E6%8A%A4%E7%9A%84%E6%A8%A1%E6%9D%BF/%E6%95%B0%E8%AE%BA%E4%B8%8E%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/" rel="prev" title="数论与组合数学">
                  <i class="fa fa-angle-left"></i> 数论与组合数学
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/06/24/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AB%9E%E8%B5%9B%E7%9B%B8%E5%85%B3/%E7%8E%B0%E5%9C%A8%E7%BB%B4%E6%8A%A4%E7%9A%84%E6%A8%A1%E6%9D%BF/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" rel="next" title="动态规划代码模板">
                  动态规划代码模板 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  
  <div class="comments giscus-container">
  </div>
  
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Overstars</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"forest","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.3.0/mermaid.min.js","integrity":"sha256-9y71g5Lz/KLsHjB8uXwnkuWDtAMDSzD/HdIbqhJfTAI="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="giscus" type="application/json">{"enable":true,"repo":"Overstars/Hexo-Site-Comments-Section","repo_id":"R_kgDOKgH-yg","category":"Announcements","category_id":"DIC_kwDOKgH-ys4CaHxz","mapping":"title","reactions_enabled":1,"emit_metadata":0,"theme":"light_high_contrast","lang":"zh-CN","crossorigin":"anonymous","input_position":"top","loading":"lazy"}</script>

<script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.page.comments) return;

  NexT.utils.loadComments('.giscus-container')
    .then(() => NexT.utils.getScript('https://giscus.app/client.js', {
      attributes: {
        async                   : true,
        crossOrigin             : 'anonymous',
        'data-repo'             : CONFIG.giscus.repo,
        'data-repo-id'          : CONFIG.giscus.repo_id,
        'data-category'         : CONFIG.giscus.category,
        'data-category-id'      : CONFIG.giscus.category_id,
        'data-mapping'          : CONFIG.giscus.mapping,
        'data-reactions-enabled': CONFIG.giscus.reactions_enabled,
        'data-emit-metadata'    : CONFIG.giscus.emit_metadata,
        'data-theme'            : CONFIG.giscus.theme,
        'data-lang'             : CONFIG.giscus.lang,
        'data-input-position'   : CONFIG.giscus.input_position,
        'data-loading'          : CONFIG.giscus.loading
      },
      parentNode: document.querySelector('.giscus-container')
    }));
});
</script>

</body>
</html>
